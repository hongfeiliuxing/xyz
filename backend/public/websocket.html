<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>Chat example</title>
    <script>
        var connection;
        window.addEventListener("load", function () {

                connection = new WebSocket("ws://" + window.location.hostname + ":3001")
                connection.onopen = function () {
                    console.log("Connection opened")
//                    connection.send(JSON.stringify(data));
                    document.getElementById("form").onsubmit = function (event) {
                        var msg = document.getElementById("msg")
                        var action = document.getElementById("action");
                        var to = document.getElementById("to");
                        if (!msg.value||!action.value) {
                            return;
                        }
                        var data = {};
                        data.action = action.value;
                        data[to.value] = msg.value;
//                        data.message = msg.value;
//                        data.to = to.value;
                        //IE 可能不支持下面方法
                        connection.send(JSON.stringify(data));
                        msg.value = "";
                        action.value = "text";
                        event.preventDefault()
                    }
                }
                connection.onclose = function () {
                    console.log("Connection closed")
                }
                connection.onerror = function () {
                    console.error("Connection error")
                }
                connection.onmessage = function (event) {
                    console.log(event.data);
                    var div = document.createElement("div")
                    div.textContent = event.data;
                    document.body.appendChild(div);
                }

        });

    </script>
</head>

<body>

<form id="form">
    action: <input size="50" id="action" value="login"> <br/>
    to: <input size="50" id="to"> <br/>
    Message: <input size="50" id="msg"> <br/>
    <input type="submit" value="Submit">
</form>
</body>
</html>
